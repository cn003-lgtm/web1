<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë¶ˆí¸í•œ ì‚¬ì—°ì†Œ (v3: ë³¸ì¸ì¸ì¦)</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>

    <style>
        /* CSSëŠ” v2ì™€ ë™ì¼í•˜ë¯€ë¡œ ìƒëµí•©ë‹ˆë‹¤. */
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap');
        body{font-family:'Noto Sans KR',sans-serif;background-color:#f4f7f6;margin:0;padding:40px 20px;box-sizing:border-box;min-height:100vh}
        .main-container{display:flex;flex-direction:column;justify-content:center;align-items:center;width:100%;gap:30px}
        .story-box,.story-list-container{background-color:#fff;border-radius:12px;box-shadow:0 10px 30px rgba(0,0,0,.1);padding:30px 40px;width:100%;max-width:500px}
        .story-box h1{color:#333;margin-top:0;margin-bottom:10px;text-align:center}
        .story-box p{color:#777;margin-bottom:30px;text-align:center}
        .input-group{margin-bottom:20px;text-align:left}
        .input-group label{display:block;margin-bottom:8px;font-weight:700;color:#555}
        .input-group input,.input-group textarea{width:100%;padding:12px 15px;border:1px solid #ddd;border-radius:8px;box-sizing:border-box;font-size:16px;font-family:'Noto Sans KR',sans-serif}
        .input-group textarea{height:150px;resize:vertical}
        .submit-btn{width:100%;padding:15px;border:none;border-radius:8px;background:linear-gradient(45deg,#5a67d8,#8a5ad8);color:#fff;font-size:18px;font-weight:700;cursor:pointer;transition:all .3s ease}
        .submit-btn:hover{box-shadow:0 5px 15px rgba(90,103,216,.4);transform:translateY(-2px)}
        .submit-btn:disabled{background:#ccc;cursor:not-allowed;transform:none;box-shadow:none}
        .story-list-container h2{color:#333;margin-top:0;margin-bottom:20px;text-align:center}
        #story-list{list-style:none;padding:0;margin:0;max-height:450px;overflow-y:auto;padding-right:10px}
        .story-item{border-bottom:1px solid #eee;padding:15px 5px;text-align:left}
        .story-item:last-child{border-bottom:none}
        .story-title{font-size:17px;font-weight:700;color:#5a67d8;cursor:pointer;margin:0}
        .story-title:hover{text-decoration:underline}
        .story-details{display:none;margin-top:15px;padding-left:5px}
        .story-details p{font-size:15px;color:#555;margin:0 0 15px 0;line-height:1.6;white-space:pre-wrap}
        .story-controls{display:flex;gap:10px;justify-content:flex-end;margin-top:10px}
        .edit-btn,.delete-btn{border:none;border-radius:5px;padding:6px 12px;font-size:13px;font-weight:700;cursor:pointer;transition:all .2s ease}
        .edit-btn{background-color:#e2e8f0;color:#4a5568}
        .edit-btn:hover{background-color:#cbd5e0}
        .delete-btn{background-color:#fee2e2;color:#c53030}
        .delete-btn:hover{background-color:#fecaca}
        .list-placeholder{text-align:center;color:#999;padding:30px;font-size:15px}
        .modal-overlay{position:fixed;top:0;left:0;width:100%;height:100%;background-color:rgba(0,0,0,.5);display:none;justify-content:center;align-items:center;z-index:1000}
        .modal-content{background-color:#fff;padding:30px 40px;border-radius:12px;box-shadow:0 10px 40px rgba(0,0,0,.2);width:100%;max-width:450px}
        .modal-content h2{margin-top:0;text-align:center}
        .modal-buttons{display:flex;gap:10px;margin-top:20px}
        #cancel-edit-btn{width:100%;padding:13px;border:1px solid #ddd;border-radius:8px;background:#eee;color:#555;font-size:16px;font-weight:700;cursor:pointer}
        #save-edit-btn{width:100%;padding:13px;border:none;border-radius:8px;background:#5a67d8;color:#fff;font-size:16px;font-weight:700;cursor:pointer}
    </style>
</head>
<body>

    <div class="main-container">

        <div class="story-box">
            <h1>ğŸ’Œ ë¶ˆí¸í•œ ì‚¬ì—°ì†Œ</h1>
            <p>ìˆì—ˆë˜ ë¶ˆí¸í•œ ì¼, ê³ ë¯¼, í•˜ê³  ì‹¶ì€ ë§ì„ ë‚¨ê²¨ì£¼ì„¸ìš”.</p>
            
            <div class="input-group">
                <label for="nickname">ì‘ì„±ì (ìµëª…)</label>
                <input type="text" id="nickname" placeholder="ë‹‰ë„¤ì„ì„ ì…ë ¥í•˜ì„¸ìš”">
            </div>
            
            <div class="input-group">
                <label for="story">ì‚¬ì—° ë‚´ìš©</label>
                <textarea id="story" placeholder="ì´ê³³ì— ì‚¬ì—°ì„ ì ì–´ì£¼ì„¸ìš”..."></textarea>
            </div>
            
            <button id="submitBtn" class="submit-btn" disabled>
                ì¸ì¦ ì¤‘...
            </button>
        </div>

        <div class="story-list-container">
            <h2>ğŸ“¬ ë‚˜ì˜ ì‚¬ì—°ë“¤</h2>
            <ul id="story-list">
                <li class="list-placeholder">ì‚¬ì—°ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</li>
            </ul>
        </div>
    </div>

    <div id="edit-modal" class="modal-overlay">
        <div class="modal-content">
            <h2>âœï¸ ì‚¬ì—° ìˆ˜ì •í•˜ê¸°</h2>
            <input type="hidden" id="edit-doc-id">
            <div class="input-group">
                <label for="edit-nickname">ì‘ì„±ì</label>
                <input type="text" id="edit-nickname">
            </div>
            <div class="input-group">
                <label for="edit-story">ì‚¬ì—° ë‚´ìš©</label>
                <textarea id="edit-story"></textarea>
            </div>
            <div class="modal-buttons">
                <button id="cancel-edit-btn">ì·¨ì†Œ</button>
                <button id="save-edit-btn">ìˆ˜ì • ì™„ë£Œ</button>
            </div>
        </div>
    </div>


    <script>
        // --- 1. Firebase ì„¤ì • (v2ì™€ ë™ì¼) ---
        const firebaseConfig = {
            apiKey: "AIzaSyA8wBlDD0NhhgEwKHdVg1IKeZR7BQFS6bk",
            authDomain: "project-13e0e.firebaseapp.com",
            databaseURL: "https://project-13e0e-default-rtdb.firebaseio.com",
            projectId: "project-13e0e",
            storageBucket: "project-13e0e.firebasestorage.app",
            messagingSenderId: "1031185461805",
            appId: "1:1031185461805:web:b64f48c61597e92741bea4",
            measurementId: "G-7MH7G2ZGDD"
        };
        firebase.initializeApp(firebaseConfig);

        // --- 3. Firestore ë° NEW! Auth ì„œë¹„ìŠ¤ ì¸ìŠ¤í„´ìŠ¤ ---
        const db = firebase.firestore();
        const auth = firebase.auth(); // (NEW!) ì¸ì¦ ì„œë¹„ìŠ¤ ì´ˆê¸°í™”
        console.log("âœ… Firebase, Firestore, Auth ì´ˆê¸°í™” ì„±ê³µ!");

        
        // --- 4. NEW! í˜„ì¬ ì‚¬ìš©ì IDë¥¼ ì €ì¥í•  ë³€ìˆ˜ ---
        let currentUserId = null;


        // --- 5. NEW! ì¸ì¦ ìƒíƒœ ê°ì§€ ë° ìµëª… ë¡œê·¸ì¸ ---
        
        // HTML ìš”ì†Œ ë¯¸ë¦¬ ê°€ì ¸ì˜¤ê¸°
        const nicknameInput = document.getElementById("nickname");
        const storyInput = document.getElementById("story");
        const submitButton = document.getElementById("submitBtn");
        const storyListElement = document.getElementById("story-list");

        /**
         * auth.onAuthStateChanged
         * : ì‚¬ìš©ìì˜ ë¡œê·¸ì¸ ìƒíƒœê°€ ë³€ê²½ë  ë•Œë§ˆë‹¤ (ë¡œê·¸ì¸, ë¡œê·¸ì•„ì›ƒ) ì‹¤í–‰ë©ë‹ˆë‹¤.
         * í˜ì´ì§€ ì²« ë¡œë“œ ì‹œì—ë„ ì‹¤í–‰ë©ë‹ˆë‹¤.
         */
        auth.onAuthStateChanged(async (user) => {
            if (user) {
                // (1) ì‚¬ìš©ìê°€ ë¡œê·¸ì¸ ë˜ì–´ ìˆëŠ” ê²½ìš° (ìµëª… í¬í•¨)
                currentUserId = user.uid; // (ì¤‘ìš”!) í˜„ì¬ ì‚¬ìš©ìì˜ ê³ ìœ  IDë¥¼ ë³€ìˆ˜ì— ì €ì¥
                console.log(`âœ… ìµëª… ì‚¬ìš©ì ì¸ì¦ ì„±ê³µ (UID: ${currentUserId})`);
                
                // (1-1) 'ì‚¬ì—° ë³´ë‚´ê¸°' ë²„íŠ¼ í™œì„±í™”
                submitButton.disabled = false;
                submitButton.textContent = "ì‚¬ì—° ë³´ë‚´ê¸°";
                
                // (1-2) (ì¤‘ìš”!) ì¸ì¦ì´ ì™„ë£Œëœ í›„ì—ì•¼ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸°ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤.
                //      (currentUserIdê°€ í™•ì •ë˜ì–´ì•¼ ëª©ë¡ ë¹„êµê°€ ê°€ëŠ¥í•˜ê¸° ë•Œë¬¸)
                loadStories(); 

            } else {
                // (2) ì‚¬ìš©ìê°€ ë¡œê·¸ì¸ ë˜ì–´ ìˆì§€ ì•Šì€ ê²½ìš° -> ìµëª…ìœ¼ë¡œ ë¡œê·¸ì¸ ì‹œë„
                console.log("ğŸ”„ ìµëª… ì‚¬ìš©ì ì¸ì¦ ì‹œë„...");
                try {
                    const userCredential = await auth.signInAnonymously();
                    // (ì„±ê³µí•˜ë©´, onAuthStateChangedê°€ ë‹¤ì‹œ í˜¸ì¶œë˜ë©° ìœ„ (1)ë²ˆ ë¡œì§ì´ ì‹¤í–‰ë©ë‹ˆë‹¤)
                    console.log("ğŸ”„ ìµëª… ë¡œê·¸ì¸ ì„±ê³µ, ìƒíƒœ ê°±ì‹  ëŒ€ê¸°...");
                } catch (error) {
                    console.error("âŒ ìµëª… ë¡œê·¸ì¸ ì‹¤íŒ¨:", error);
                    alert("âŒ ì¸ì¦ ì„œë²„ì— ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ìƒˆë¡œê³ ì¹¨ í•´ì£¼ì„¸ìš”.");
                    submitButton.textContent = "ì¸ì¦ ì‹¤íŒ¨";
                }
            }
        });


        // --- 6. NEW! ì‹¤ì‹œê°„ ì‚¬ì—° ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸° (v4: 'ë‚˜ì˜ ì‚¬ì—°ë§Œ' ë¶ˆëŸ¬ì˜¤ê¸°) ---
        
        function loadStories() {
            // (v3ì˜ ë¡œì§ê³¼ ê±°ì˜ ë™ì¼í•˜ë‚˜, 'where' ì¡°ê±´ë¬¸ì´ ì¶”ê°€ë¨)

            // (ì¤‘ìš”!) 'currentUserId'ê°€ í™•ì •(ë¡œê·¸ì¸ ì™„ë£Œ)ëœ í›„ì—ë§Œ ì´ í•¨ìˆ˜ê°€ í˜¸ì¶œë©ë‹ˆë‹¤.
            if (!currentUserId) return; 

            // --- (v4 í•µì‹¬ ë³€ê²½ì !) ---
            // 'stories' ì»¬ë ‰ì…˜ì—ì„œ
            // 'userId' í•„ë“œê°€ 'currentUserId'(í˜„ì¬ ë‚´ ID)ì™€ "=="(ê°™ì€) ë¬¸ì„œë§Œ
            // 'createdAt'(ìƒì„±ì‹œê°„) ê¸°ì¤€ìœ¼ë¡œ 'desc'(ìµœì‹ ìˆœ) ì •ë ¬í•˜ì—¬ ê°€ì ¸ì˜µë‹ˆë‹¤.
            db.collection("stories")
              .where("userId", "==", currentUserId) // ğŸ‘ˆ ì´ ì¤„ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!
              .orderBy("createdAt", "desc")
              .onSnapshot((snapshot) => {
                
                console.log("ğŸ”„ 'ë‚˜ì˜' ì‚¬ì—° ëª©ë¡ ì—…ë°ì´íŠ¸ ê°ì§€!");
                storyListElement.innerHTML = ""; 

                if (snapshot.empty) {
                    storyListElement.innerHTML = `<li class="list-placeholder">ğŸ˜¢ ì•„ì§ ë‚´ê°€ ë³´ë‚¸ ì‚¬ì—°ì´ ì—†ì–´ìš”.</li>`;
                    return;
                }

                snapshot.forEach(doc => {
                    const story = doc.data(); 
                    const docId = doc.id;     
                    
                    const storyItem = document.createElement("li");
                    storyItem.className = "story-item";
                    
                    const titleEl = document.createElement("h3");
                    titleEl.className = "story-title";
                    titleEl.textContent = "ğŸ‘¤ " + story.title;
                    
                    const detailsEl = document.createElement("div");
                    detailsEl.className = "story-details"; 

                    const contentEl = document.createElement("p");
                    contentEl.textContent = story.content;
                    
                    detailsEl.appendChild(contentEl); 
                    
                    // (v3ì™€ ë™ì¼í•œ ë²„íŠ¼ ë¡œì§)
                    // ì–´ì°¨í”¼ 'ë‚´ ê¸€'ë§Œ ë¶ˆëŸ¬ì™”ìœ¼ë¯€ë¡œ ifë¬¸ìœ¼ë¡œ ê²€ì‚¬í•  í•„ìš” ì—†ì´
                    // ëª¨ë“  í•­ëª©ì— ìˆ˜ì •/ì‚­ì œ ë²„íŠ¼ì„ ì¶”ê°€í•˜ë©´ ë©ë‹ˆë‹¤.
                    const controlsEl = document.createElement("div");
                    controlsEl.className = "story-controls";

                    const editBtn = document.createElement("button");
                    editBtn.className = "edit-btn";
                    editBtn.textContent = "ìˆ˜ì •";
                    editBtn.dataset.id = docId;
                    editBtn.dataset.title = story.title;
                    editBtn.dataset.content = story.content;

                    const deleteBtn = document.createElement("button");
                    deleteBtn.className = "delete-btn";
                    deleteBtn.textContent = "ì‚­ì œ";
                    deleteBtn.dataset.id = docId;

                    controlsEl.appendChild(editBtn);
                    controlsEl.appendChild(deleteBtn);
                    detailsEl.appendChild(controlsEl); 

                    storyItem.appendChild(titleEl);
                    storyItem.appendChild(detailsEl);
                    storyListElement.appendChild(storyItem);
                });

            }, (error) => {
                // --- (ğŸš¨ ë§¤ìš° ì¤‘ìš”! ğŸš¨) ---
                // ì´ ì½”ë“œë¥¼ ì²˜ìŒ ì‹¤í–‰í•˜ë©´ 'ì¸ë±ìŠ¤(ìƒ‰ì¸)ê°€ ì—†ë‹¤'ëŠ” ì—ëŸ¬ê°€ ë°œìƒí•©ë‹ˆë‹¤.
                // ë¸Œë¼ìš°ì € ê°œë°œì ë„êµ¬(F12)ì˜ 'Console' íƒ­ì„ í™•ì¸í•˜ì„¸ìš”!
                console.error("âŒ 'ë‚˜ì˜' ì‚¬ì—° ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:", error.message);
                storyListElement.innerHTML = `<li class="list-placeholder">âŒ ëª©ë¡ ë¡œë”© ì‹¤íŒ¨ (ì˜¤ë¥˜ ë°œìƒ)</li>`;

                // 'ì¸ë±ìŠ¤ ìƒì„± ë§í¬'ê°€ í¬í•¨ëœ ì—ëŸ¬ ë©”ì‹œì§€ë¥¼ ì½˜ì†”ì— ë³„ë„ë¡œ ì¶œë ¥
                if (error.code === "failed-precondition") {
                    console.warn(
                        "ğŸš¨ Firestore ì¸ë±ìŠ¤ê°€ í•„ìš”í•©ë‹ˆë‹¤! ğŸš¨" +
                        "ì—ëŸ¬ ë©”ì‹œì§€ì— í¬í•¨ëœ URL ë§í¬ë¥¼ í´ë¦­í•˜ì—¬ ì¸ë±ìŠ¤ë¥¼ ìƒì„±í•´ì£¼ì„¸ìš”." +
                        "ìƒì„± í›„ ëª‡ ë¶„ ì •ë„ ê¸°ë‹¤ë ¤ì•¼ í•©ë‹ˆë‹¤."
                    );
                }
            });
        }

        
        /**
         * 7. 'ë°ì´í„° ì €ì¥' í•¨ìˆ˜ (NEW: userId ì¶”ê°€, ì˜¤íƒ€ ìˆ˜ì •ë¨)
         */
        async function saveNewStory(storyTitle, storyContent) {
            console.log(`â³ [${storyTitle}] ì €ì¥ ì‹œë„...`);
            
            const dataToSave = {
                title: storyTitle,
                content: storyContent,
                createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                userId: currentUserId 
            };

            try {
                const collectionRef = db.collection("stories");
                const docRef = await collectionRef.add(dataToSave);
                
                // --- (ìˆ˜ì •ëœ ë¶€ë¶„!) ---
                // "docId"ê°€ ì•„ë‹ˆë¼ "docRef.id"ì…ë‹ˆë‹¤.
                console.log(`âœ… [${storyTitle}] ì €ì¥ ì„±ê³µ! (ID: ${docRef.id})`); 
                // ---------------------

                return true; // ì„±ê³µ
                
            } catch (error) {
                console.error("âŒ ë°ì´í„° ì €ì¥ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", error);
                return false; // ì‹¤íŒ¨
            }
        }

        // --- 8. 'ì‚¬ì—° ë³´ë‚´ê¸°' ë²„íŠ¼ ê¸°ëŠ¥ (v2ì™€ ê±°ì˜ ë™ì¼) ---
        submitButton.addEventListener("click", async () => {
            const nickname = nicknameInput.value;
            const story = storyInput.value;

            if (!currentUserId) { // (NEW!) í˜¹ì‹œ ëª¨ë¥¼ ì¸ì¦ ì˜¤ë¥˜ ì²´í¬
                alert("ğŸ˜¥ ì‚¬ìš©ì ì¸ì¦ì´ ì™„ë£Œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
                return;
            }
            if (!nickname || !story) {
                alert("ğŸ˜¥ ì‘ì„±ìì™€ ì‚¬ì—°ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”!");
                return;
            }

            submitButton.disabled = true;
            submitButton.textContent = "ì „ì†¡ ì¤‘ì…ë‹ˆë‹¤...";

            // (v2ì™€ ë™ì¼)
            const isSuccess = await saveNewStory(nickname, story);

            submitButton.disabled = false;
            submitButton.textContent = "ì‚¬ì—° ë³´ë‚´ê¸°";

            if (isSuccess) {
                alert("ğŸ’Œ ì‚¬ì—°ì´ ì„±ê³µì ìœ¼ë¡œ ì „ì†¡ë˜ì—ˆìŠµë‹ˆë‹¤.");
                nicknameInput.value = "";
                storyInput.value = "";
            } else {
                alert("âŒ ì „ì†¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
            }
        });


        // --- 9. 'ëª©ë¡ ì´ë²¤íŠ¸ ì²˜ë¦¬' (v2ì™€ ë™ì¼) ---
        // (ìˆ˜ì •/ì‚­ì œ ë²„íŠ¼ì´ 'ë³¸ì¸ ê¸€'ì—ë§Œ ìƒì„±ë˜ë¯€ë¡œ, 
        //  ì´ ì½”ë“œëŠ” ì–´ì°¨í”¼ ë³¸ì¸ ê¸€ì—ë§Œ ì‘ë™í•˜ê²Œ ë©ë‹ˆë‹¤.)
        storyListElement.addEventListener("click", (event) => {
            const target = event.target; 

            // (1) 'ë‹‰ë„¤ì„ (ì œëª©)' í´ë¦­
            if (target.classList.contains("story-title")) {
                const details = target.nextElementSibling;
                details.style.display = (details.style.display === "block") ? "none" : "block";
            }

            // (2) 'ì‚­ì œ' ë²„íŠ¼ í´ë¦­
            if (target.classList.contains("delete-btn")) {
                const docId = target.dataset.id;
                if (confirm("ğŸ˜¥ ì´ ì‚¬ì—°ì„ ì •ë§ë¡œ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
                    deleteStory(docId); 
                }
            }

            // (3) 'ìˆ˜ì •' ë²„íŠ¼ í´ë¦­
            if (target.classList.contains("edit-btn")) {
                const docId = target.dataset.id;
                const currentTitle = target.dataset.title;
                const currentContent = target.dataset.content;
                showEditModal(docId, currentTitle, currentContent);
            }
        });

        // --- 10. 'ë°ì´í„° ì‚­ì œ' í•¨ìˆ˜ (v2ì™€ ë™ì¼) ---
        // (ë³´ì•ˆ ê·œì¹™ì´ ì„œë²„ì—ì„œ ë§‰ì•„ì£¼ë¯€ë¡œ JS ì½”ë“œëŠ” ìˆ˜ì •í•  í•„ìš” ì—†ìŒ)
        async function deleteStory(docId) {
            console.log(`â³ [${docId}] ì‚­ì œ ì‹œë„...`);
            try {
                await db.collection("stories").doc(docId).delete();
                console.log(`âœ… [${docId}] ì‚­ì œ ì„±ê³µ!`);
            } catch (error) {
                // (NEW!) ë³¸ì¸ ê¸€ì´ ì•„ë‹ ê²½ìš° ì´ errorê°€ ë°œìƒí•©ë‹ˆë‹¤.
                console.error("âŒ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", error.message);
                alert("âŒ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. (ê¶Œí•œì´ ì—†ê±°ë‚˜ ì˜¤ë¥˜ ë°œìƒ)");
            }
        }


        // --- 11. 'ìˆ˜ì • ëª¨ë‹¬' ê´€ë ¨ í•¨ìˆ˜ (v2ì™€ ë™ì¼) ---
        
        // (v2ì™€ ë™ì¼í•œ ëª¨ë‹¬ DOM ìš”ì†Œë“¤)
        const modal = document.getElementById("edit-modal");
        const modalDocIdInput = document.getElementById("edit-doc-id");
        const modalNicknameInput = document.getElementById("edit-nickname");
        const modalStoryInput = document.getElementById("edit-story");
        const saveEditButton = document.getElementById("save-edit-btn");
        const cancelEditButton = document.getElementById("cancel-edit-btn");
        
        // (v2ì™€ ë™ì¼í•œ í•¨ìˆ˜ë“¤)
        function showEditModal(docId, title, content) {
            modalDocIdInput.value = docId;
            modalNicknameInput.value = title;
            modalStoryInput.value = content;
            modal.style.display = "flex";
        }
        function hideEditModal() {
            modal.style.display = "none";
        }
        cancelEditButton.addEventListener("click", hideEditModal);
        
        // (v2ì™€ ë™ì¼í•œ 'ìˆ˜ì • ì™„ë£Œ' ë²„íŠ¼ ë¡œì§)
        saveEditButton.addEventListener("click", async () => {
            const docId = modalDocIdInput.value;
            const newTitle = modalNicknameInput.value;
            const newContent = modalStoryInput.value;

            if (!newTitle || !newContent) {
                alert("ğŸ˜¥ ë‹‰ë„¤ì„ê³¼ ì‚¬ì—° ë‚´ìš©ì„ ëª¨ë‘ ì…ë ¥í•´ì•¼ í•©ë‹ˆë‹¤.");
                return;
            }

            saveEditButton.disabled = true;
            saveEditButton.textContent = "ì €ì¥ ì¤‘...";
            
            // 'updateStory' í•¨ìˆ˜ í˜¸ì¶œ
            const isSuccess = await updateStory(docId, newTitle, newContent);

            saveEditButton.disabled = false;
            saveEditButton.textContent = "ìˆ˜ì • ì™„ë£Œ";

            if (isSuccess) {
                alert("âœ¨ ì‚¬ì—°ì´ ì„±ê³µì ìœ¼ë¡œ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.");
                hideEditModal();
            } else {
                alert("âŒ ìˆ˜ì •ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. (ê¶Œí•œì´ ì—†ê±°ë‚˜ ì˜¤ë¥˜ ë°œìƒ)");
            }
        });

        /**
         * 12. 'ë°ì´í„° ìˆ˜ì •' í•¨ìˆ˜ (v2ì™€ ë™ì¼)
         * (ë³´ì•ˆ ê·œì¹™ì´ ì„œë²„ì—ì„œ ë§‰ì•„ì£¼ë¯€ë¡œ JS ì½”ë“œëŠ” ìˆ˜ì •í•  í•„ìš” ì—†ìŒ)
         */
        async function updateStory(docId, newTitle, newContent) {
            console.log(`â³ [${docId}] ìˆ˜ì • ì‹œë„...`);
            const dataToUpdate = {
                title: newTitle,
                content: newContent
            };
            try {
                await db.collection("stories").doc(docId).update(dataToUpdate);
                console.log(`âœ… [${docId}] ìˆ˜ì • ì„±ê³µ!`);
                return true;
            } catch (error) {
                // (NEW!) ë³¸ì¸ ê¸€ì´ ì•„ë‹ ê²½ìš° ì´ errorê°€ ë°œìƒí•©ë‹ˆë‹¤.
                console.error("âŒ ìˆ˜ì • ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", error.message);
                return false;
            }
        }
    </script>
</body>
</html>